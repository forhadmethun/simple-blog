<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Simple Blog</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/jquery.dataTables.css">
    <!-- Google fonts - Open Sans-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700">
    <!-- Fancy Box-->
    <link rel="stylesheet" href="/css/jquery.fancybox.css">
    <!-- Animaition-->
    <link rel="stylesheet" href="/css/animsition.min.css">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="/css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="/css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="/img/favicon.ico">
    <!-- Font Awesome CDN-->
    <!-- you can replace it by local Font Awesome-->
    <script src="https://use.fontawesome.com/99347ac47f.js"></script>
    <!-- Font Icons CSS-->
    <link rel="stylesheet" href="/css/fontastic.css">

    {% block stylesheets %}{% endblock %}
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
    <script>
        var post_id = 1;
    </script>
</head>
<body>
<div class="animsition">
    <header class="header">
        <!-- Main Navbar-->
        <nav class="navbar navbar-toggleable-md">
            <div class="search-area">
                <div class="search-area-inner d-flex align-items-center justify-content-center">
                    <div class="close-btn"><i class="icon-close"></i></div>
                    <div class="row">
                        <div class="col-md-8 push-md-2">
                            <form action="#">
                                <div class="form-group">
                                    <input type="search" name="search" id="search"
                                           placeholder="What are you looking for?">
                                    <button type="submit" class="submit"><i class="icon-search-1"></i></button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <!-- Navbar Brand -->
                <div class="navbar-header d-flex align-items-center justify-content-between">
                    <!-- Navbar Brand --><a href="{{ path('main') }}" class="navbar-brand animsition-link">Simple
                        Blog</a>
                    <!-- Toggle Button-->
                    <button type="button" data-toggle="collapse" data-target="#navbarcollapse"
                            aria-controls="navbarcollapse" aria-expanded="false" aria-label="Toggle navigation"
                            class="navbar-toggler"><span></span><span></span><span></span></button>
                </div>
                <!-- Navbar Menu -->
                <div id="navbarcollapse" class="collapse navbar-collapse">
                    <ul class="navbar-nav ml-auto">
                        <!-- Search-->
                        {#                        <li class="nav-item"><a  href="{{ path('main') }}" class="nav-link animsition-link active">Home</a></li>#}
                        {#                        <li class="nav-item"><a  href="{{ path('main') }}" class="nav-link animsition-link">Blog</a></li>#}
                    </ul>
                    <div class="navbar-text"><a href="#" class="search-btn"><i class="icon-search-1"></i></a></div>
                    <ul class="langs navbar-text">

                        {% if app.user %}
                            <a href="{{ path('post.index') }}">Dashboard</a> |
                            <a href="{{ path('app_logout') }}">Log out</a>
                        {% endif %}

                        {% if not app.user %}
                            <a href="{{ path('app_login') }}">Log in</a> &nbsp; &nbsp;
                            <a href="{{ path('user_registration') }}">Register</a>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <div class="row" style="min-height: 500px">
            {% block body %}{% endblock %}
        </div>
    </div>
    {% block javascripts %}{% endblock %}
    <!-- Page Footer-->
    <footer class="main-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3"></div>
                <div class="col-md-3">
                    <div class="logo">
                        <h6 class="text-white">Simple Blog</h6>
                    </div>
                    <div class="contact-details">
                        <p>Kristinee, Harujama, Tallinn, Estonia</p>
                        <p>Email: <a href="mailto:forhadmethun@gmail.com">forhadmethun@gmail.com</a></p>
                        <ul class="social-menu">
                            <li class="list-inline-item"><a href="#"><i class="fa fa-facebook"></i></a></li>
                            <li class="list-inline-item"><a href="#"><i class="fa fa-twitter"></i></a></li>
                            <li class="list-inline-item"><a href="#"><i class="fa fa-instagram"></i></a></li>
                            <li class="list-inline-item"><a href="#"><i class="fa fa-behance"></i></a></li>
                            <li class="list-inline-item"><a href="#"><i class="fa fa-pinterest"></i></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="menus d-flex">
                        <ul class="list-unstyled">
                            <li><a href="#">My Account</a></li>
                            <li><a href="#">Add Listing</a></li>
                            <li><a href="#">Pricing</a></li>
                            <li><a href="#">Privacy &amp; Policy</a></li>
                        </ul>
                        <ul class="list-unstyled">
                            <li><a href="#">Partners</a></li>
                            <li><a href="#">FAQ</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="copyrights">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <p>&copy; 2020. All rights reserved. </p>
                    </div>
                    <div class="col-md-6 text-right"></div>
                </div>
            </div>
        </div>
    </footer>
</div>
<button type="button" data-toggle="collapse" data-target="#style-switch" id="style-switch-button"
        class="btn btn-primary btn-sm hidden-xs hidden-sm"><i class="fa fa-cog fa-2x"></i></button>
<!-- Javascript files-->
<script src="/js/jquery.min.js"></script>
<script src="/js/tether.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.cookie.js"></script>
<script src="/js/jquery.fancybox.min.js"></script>
<script src="/js/animsition.min.js"></script>
<script src="/js/front.js"></script>
<script src="/js/jquery.dataTables.js"></script>
<script>
    $(document).ready(function () {
        $('#table_id').DataTable();
    });
</script>

<script>
    $(document).ready(function () {
        $("#comment_form").submit(function (e) {
            e.preventDefault();
            var commentElements = $("#comment_form").serializeArray()
            $("#comment_form")[0].reset();
            $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                },
                url: getBaseUrl() + 'blog/comment/' + post_id,
                type: 'POST',
                data: JSON.stringify({
                    'commenterName': commentElements[0].value,
                    'commenterEmail': commentElements[1].value,
                    'commentBody': commentElements[2].value
                }),
                dataType: 'json',
                async: true
            }).done(function (output) {
                $("#comments").html('');
                let comments = '';
                for (let index = 0; index < output.length; ++index) {
                    comments += generateSingleComment(output[index], false);
                }
                $("#comments").html(comments);
            }).fail(function (output) {
                console.log("Ajax call failed");
            }).always(function () {
                console.log('always called');
            });

        });
    });

    function generateSingleComment(comment, isCommentDelete) {
        var commentElement = '';
        {% if app.user %}
        commentElement = '<a href="#" onclick="deleteComment(' + comment.id + ');return false;" class="text-danger">Delete</a>\n';
        {% endif %}
        if (!isCommentDelete) {
            commentElement = '';
        }
        return '<div class="comment">\n' +
            '                            <div class="comment-header d-flex justify-content-between">\n' +
            '                                <div class="user d-flex align-items-center">\n' +
            '                                    <div class="image"><img src="/img/user.svg" alt="..." class="img-fluid rounded-circle"></div>\n' +
            '                                    <div class="title"><strong>' + comment.commenterName + ' | ' + comment.commenterEmail + '</strong><span class="date">' + new Date(comment.createdAt.date).toLocaleDateString("en-US") + '</span>' +
            ' ' + commentElement + '\n' +
            '</div>\n' +
            '                                </div>\n' +
            '                            </div>\n' +
            '                            <div class="comment-body">\n' +
            '                                <p>' + comment.commentBody + '</p>\n' +
            '                            </div>\n' +
            '                        </div>';
    }

    function getBaseUrl() {
        var base_url = window.location.origin;
        return base_url + "/";
    }

    function deleteComment(commentId) {
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            },
            url: getBaseUrl() + 'blog/comment/delete/' + commentId,
            type: 'POST',
            data: null,
            dataType: 'json',
            async: true
        }).done(function (output) {
            $("#comments").html('');
            let comments = '';
            for (let index = 0; index < output.length; ++index) {
                comments += generateSingleComment(output[index], true);
            }
            $("#comments").html(comments);
        }).fail(function (output) {
            console.log("Ajax call failed");
        }).always(function () {
            console.log('always called');
        });
    }
</script>

</body>
</html>
